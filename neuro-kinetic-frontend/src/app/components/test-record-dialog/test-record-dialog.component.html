<p-dialog 
  [(visible)]="visible" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '700px' }"
  [header]="isEditMode ? 'Edit Test Record' : 'View Test Record'"
  (onHide)="onClose()"
  styleClass="test-record-dialog">
  
  <form [formGroup]="recordForm" *ngIf="record" class="test-record-form">
    <!-- User Information Section -->
    <div class="form-section">
      <div class="section-header">
        <svg class="section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        <h3 class="section-title">User Information</h3>
      </div>
      
      <div class="form-grid">
        <!-- User Name -->
        <div class="form-field">
          <label for="userName" class="form-label">
            <svg class="label-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            User Name
          </label>
          <div class="input-wrapper">
            <input 
              pInputText 
              id="userName" 
              formControlName="userName"
              class="form-input readonly-input"
              readonly />
          </div>
        </div>

        <!-- Test Date -->
        <div class="form-field">
          <label for="testDate" class="form-label">
            <svg class="label-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Test Date
          </label>
          <div class="input-wrapper">
            <p-calendar 
              formControlName="testDate"
              [disabled]="true"
              dateFormat="mm/dd/yy"
              [showTime]="true"
              [showButtonBar]="false"
              styleClass="w-full">
            </p-calendar>
          </div>
        </div>
      </div>
    </div>

    <!-- Test Results Section -->
    <div class="form-section">
      <div class="section-header">
        <svg class="section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h3 class="section-title">Test Results</h3>
      </div>
      
      <div class="form-grid">
        <!-- Test Result -->
        <div class="form-field">
          <label for="testResult" class="form-label">
            <svg class="label-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Test Result
            <span class="required-indicator">*</span>
          </label>
          <div class="input-wrapper">
            <p-dropdown 
              formControlName="testResult"
              [options]="testResultOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="Select Result"
              [disabled]="!isEditMode"
              styleClass="w-full">
            </p-dropdown>
          </div>
        </div>

        <!-- Accuracy -->
        <div class="form-field">
          <label for="accuracy" class="form-label">
            <svg class="label-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
            Accuracy (%)
            <span class="required-indicator">*</span>
          </label>
          <div class="input-wrapper">
            <input 
              pInputText 
              id="accuracy" 
              type="number"
              formControlName="accuracy"
              [disabled]="!isEditMode"
              min="0"
              max="100"
              class="form-input" />
            <div class="accuracy-indicator">
              <div class="accuracy-bar" [style.width.%]="recordForm.get('accuracy')?.value || 0"></div>
            </div>
          </div>
          <small *ngIf="recordForm.get('accuracy')?.invalid && recordForm.get('accuracy')?.touched" 
                 class="error-message">
            <svg class="error-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Accuracy must be between 0 and 100
          </small>
        </div>

        <!-- Status -->
        <div class="form-field">
          <label for="status" class="form-label">
            <svg class="label-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Status
            <span class="required-indicator">*</span>
          </label>
          <div class="input-wrapper">
            <p-dropdown 
              formControlName="status"
              [options]="statusOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="Select Status"
              [disabled]="!isEditMode"
              styleClass="w-full">
            </p-dropdown>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Information Section -->
    <div class="form-section">
      <div class="section-header">
        <svg class="section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h3 class="section-title">Additional Information</h3>
      </div>
      
      <div class="form-grid">
        <!-- Voice Recording URL -->
        <div class="form-field full-width">
          <label for="voiceRecordingUrl" class="form-label">
            <svg class="label-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
            Voice Recording URL
          </label>
          <div class="input-wrapper">
            <input 
              pInputText 
              id="voiceRecordingUrl" 
              formControlName="voiceRecordingUrl"
              [disabled]="!isEditMode"
              class="form-input"
              placeholder="Enter recording URL" />
          </div>
        </div>

        <!-- Analysis Notes -->
        <div class="form-field full-width">
          <label for="analysisNotes" class="form-label">
            <svg class="label-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            Analysis Notes
          </label>
          <div class="input-wrapper">
            <textarea 
              pInputTextarea 
              id="analysisNotes" 
              formControlName="analysisNotes"
              [disabled]="!isEditMode"
              [rows]="4"
              class="form-textarea"
              placeholder="Enter analysis notes or additional comments...">
            </textarea>
          </div>
        </div>
      </div>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <div class="dialog-footer">
      <p-button 
        label="Cancel" 
        icon="pi pi-times"
        (onClick)="onCancel()" 
        [outlined]="true"
        styleClass="p-button-secondary cancel-button">
      </p-button>
      <p-button 
        *ngIf="isEditMode"
        label="Save Changes" 
        icon="pi pi-check"
        (onClick)="onSave()" 
        [disabled]="!recordForm.valid"
        styleClass="p-button-primary save-button">
      </p-button>
    </div>
  </ng-template>
</p-dialog>

